/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

plugins {
  id 'java'
  id 'maven-publish'
  id "com.xebialabs.xldp" version "1.0.5"
  id "de.gliderpilot.semantic-release" version "1.4.0"
}

apply plugin: 'java'
apply plugin: 'idea'
apply plugin: 'eclipse'
apply plugin: 'maven'

// publishing {
//     publications {
//         mavenJava(MavenPublication) {
//             artifact source: xlPlugin, extension: 'xldp'
//         }
//     }
//     repositories {
//         maven {
//             def releasesRepoUrl = "https://nexus.example.com:8443/nexus/content/repositories/java-releases/"
//             def snapshotsRepoUrl = "https://nexus.example.com:8443/nexus/content/repositories/java-snapshots/"
//             url = version.toString().endsWith('SNAPSHOT') ? snapshotsRepoUrl : releasesRepoUrl

//             credentials {
//                 username = System.properties['gradle.user']
//                 password = System.properties['gradle.password']
//             }
//         }
//     }
// }

task changeLog {
    doLast {
        def commits = semanticRelease.changeLog.commits(
            com.github.zafarkhaja.semver.Version.valueOf(
            project.version.inferredVersion.previousVersion))
        println "Scope: " + semanticRelease.changeLog.changeScope(commits)
        println "ChangeLog:" + semanticRelease.changeLog.changeLog(commits, project.version.inferredVersion)
    }
}

task pluginVersion(type: WriteProperties) {
    outputFile = file('src/main/resources/plugin-version.properties')
    comment 'Copyright ABC'
    property 'plugin', project.name
    property 'version', project.version
}

// Optional: when not using master as mainline the correct branch needs to be included in release branches 
semanticRelease {
    releaseBranches {
        include 'main'
    }
}

processResources.dependsOn pluginVersion
changeLog.dependsOn build
project.tasks.release.dependsOn changeLog
